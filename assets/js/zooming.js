!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Zooming=e()}(this,function(){"use strict";var t={default:"default",zoomIn:"zoom-in",zoomOut:"zoom-out",grab:"grab",move:"move"};function e(t,e,i){var n=!(arguments.length>3)||void 0===arguments[3]||arguments[3],s={passive:!1};n?t.addEventListener(e,i,s):t.removeEventListener(e,i,s)}function i(t,e){if(t){var i=new Image;i.onload=function t(){e&&e(i)},i.src=t}}function n(t){return t.dataset.original?t.dataset.original:"A"===t.parentNode.tagName?t.parentNode.getAttribute("href"):null}function s(t,e,i){!function t(e){var i=o.transitionProp,n=o.transformProp;if(e.transition){var s=e.transition;delete e.transition,e[i]=s}if(e.transform){var r=e.transform;delete e.transform,e[n]=r}}(e);var n=t.style,s={};for(var r in e)i&&(s[r]=n[r]||""),n[r]=e[r];return s}var o={transitionProp:"transition",transEndEvent:"transitionend",transformProp:"transform",transformCssProp:"transform"},r=o.transformCssProp,a=o.transEndEvent,l=function t(){},h={enableGrab:!0,preloadImage:!1,closeOnWindowResize:!0,transitionDuration:.4,transitionTimingFunction:"cubic-bezier(0.4, 0, 0, 1)",bgColor:"rgb(255, 255, 255)",bgOpacity:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,zIndex:998,customSize:null,onOpen:l,onClose:l,onGrab:l,onMove:l,onRelease:l,onBeforeOpen:l,onBeforeClose:l,onBeforeGrab:l,onBeforeRelease:l,onImageLoading:l,onImageLoaded:l},c={init:function t(e){!function t(e,i){Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(function t(n){e[n]=e[n].bind(i)})}(this,e)},click:function t(e){if(e.preventDefault(),f(e))return window.open(this.target.srcOriginal||e.currentTarget.src,"_blank");this.shown?this.released?this.close():this.release():this.open(e.currentTarget)},scroll:function t(){var e=document.documentElement||document.body.parentNode||document.body,i=window.pageXOffset||e.scrollLeft,n=window.pageYOffset||e.scrollTop;null===this.lastScrollPosition&&(this.lastScrollPosition={x:i,y:n});var s=this.lastScrollPosition.x-i,o=this.lastScrollPosition.y-n,r=this.options.scrollThreshold;(Math.abs(o)>=r||Math.abs(s)>=r)&&(this.lastScrollPosition=null,this.close())},keydown:function t(e){var i;i=e,("Escape"===(i.key||i.code)||27===i.keyCode)&&(this.released?this.close():this.release(this.close))},mousedown:function t(e){if(!(!u(e)||f(e))){e.preventDefault();var i=e.clientX,n=e.clientY;this.pressTimer=setTimeout((function t(){this.grab(i,n)}).bind(this),200)}},mousemove:function t(e){this.released||this.move(e.clientX,e.clientY)},mouseup:function t(e){!u(e)||f(e)||(clearTimeout(this.pressTimer),this.released?this.close():this.release())},touchstart:function t(e){e.preventDefault();var i=e.touches[0],n=i.clientX,s=i.clientY;this.pressTimer=setTimeout((function t(){this.grab(n,s)}).bind(this),200)},touchmove:function t(e){if(!this.released){var i=e.touches[0],n=i.clientX,s=i.clientY;this.move(n,s)}},touchend:function t(e){var i;i=e,i.targetTouches.length,clearTimeout(this.pressTimer),this.released?this.close():this.release()},clickOverlay:function t(){this.close()},resizeWindow:function t(){this.close()}};function u(t){return 0===t.button}function f(t){return t.metaKey||t.ctrlKey}var d={init:function t(i){this.el=document.createElement("div"),this.instance=i,this.parent=document.body,s(this.el,{position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0}),this.updateStyle(i.options),e(this.el,"click",i.handler.clickOverlay.bind(i))},updateStyle:function t(e){s(this.el,{zIndex:e.zIndex,backgroundColor:e.bgColor,transition:"opacity\n        "+e.transitionDuration+"s\n        "+e.transitionTimingFunction})},insert:function t(){this.parent.appendChild(this.el)},remove:function t(){this.parent.removeChild(this.el)},fadeIn:function t(){this.el.offsetWidth,this.el.style.opacity=this.instance.options.bgOpacity},fadeOut:function t(){this.el.style.opacity=0}},p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v=function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")},y=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),g=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},m={init:function t(e,i){this.el=e,this.instance=i,this.srcThumbnail=this.el.getAttribute("src"),this.srcset=this.el.getAttribute("srcset"),this.srcOriginal=n(this.el),this.rect=this.el.getBoundingClientRect(),this.translate=null,this.scale=null,this.styleOpen=null,this.styleClose=null},zoomIn:function e(){var i=this.instance.options,n=i.zIndex,o=i.enableGrab,a=i.transitionDuration,l=i.transitionTimingFunction;this.translate=this.calculateTranslate(),this.scale=this.calculateScale(),this.styleOpen={position:"relative",zIndex:n+1,cursor:o?t.grab:t.zoomOut,transition:r+"\n        "+a+"s\n        "+l,transform:"translate3d("+this.translate.x+"px, "+this.translate.y+"px, 0px)\n        scale("+this.scale.x+","+this.scale.y+")",height:this.rect.height+"px",width:this.rect.width+"px"},this.el.offsetWidth,this.styleClose=s(this.el,this.styleOpen,!0)},zoomOut:function t(){this.el.offsetWidth,s(this.el,{transform:"none"})},grab:function e(i,n,o){var r=b(),a=r.x-i,l=r.y-n;s(this.el,{cursor:t.move,transform:"translate3d(\n        "+(this.translate.x+a)+"px, "+(this.translate.y+l)+"px, 0px)\n        scale("+(this.scale.x+o)+","+(this.scale.y+o)+")"})},move:function t(e,i,n){var o=b(),a=o.x-e,l=o.y-i;s(this.el,{transition:r,transform:"translate3d(\n        "+(this.translate.x+a)+"px, "+(this.translate.y+l)+"px, 0px)\n        scale("+(this.scale.x+n)+","+(this.scale.y+n)+")"})},restoreCloseStyle:function t(){s(this.el,this.styleClose)},restoreOpenStyle:function t(){s(this.el,this.styleOpen)},upgradeSource:function t(){if(this.srcOriginal){var e=this.el.parentNode;this.srcset&&this.el.removeAttribute("srcset");var i=this.el.cloneNode(!1);i.setAttribute("src",this.srcOriginal),i.style.position="fixed",i.style.visibility="hidden",e.appendChild(i),setTimeout((function t(){this.el.setAttribute("src",this.srcOriginal),e.removeChild(i)}).bind(this),50)}},downgradeSource:function t(){this.srcOriginal&&(this.srcset&&this.el.setAttribute("srcset",this.srcset),this.el.setAttribute("src",this.srcThumbnail))},calculateTranslate:function t(){var e=b(),i={x:this.rect.left+this.rect.width/2,y:this.rect.top+this.rect.height/2};return{x:e.x-i.x,y:e.y-i.y}},calculateScale:function t(){var e=this.el.dataset,i=e.zoomingHeight,n=e.zoomingWidth,s=this.instance.options,o=s.customSize,r=s.scaleBase;if(!o&&i&&n)return{x:n/this.rect.width,y:i/this.rect.height};if(o&&(void 0===o?"undefined":p(o))==="object")return{x:o.width/this.rect.width,y:o.height/this.rect.height};var a,l=this.rect.width/2,h=this.rect.height/2,c=b(),u={x:c.x-l,y:c.y-h},f=r+Math.min(u.x/l,u.y/h);if(o&&"string"==typeof o){var d=n||this.el.naturalWidth,v=i||this.el.naturalHeight,y=parseFloat(o)*d/(100*this.rect.width),g=parseFloat(o)*v/(100*this.rect.height);if(f>y||f>g)return{x:y,y:g}}return{x:f,y:f}}};function b(){var t,e=document.documentElement;return{x:Math.min(e.clientWidth,window.innerWidth)/2,y:Math.min(e.clientHeight,window.innerHeight)/2}}var $=function(){function s(t){v(this,s),this.target=Object.create(m),this.overlay=Object.create(d),this.handler=Object.create(c),this.body=document.body,this.shown=!1,this.lock=!1,this.released=!0,this.lastScrollPosition=null,this.pressTimer=null,this.options=g({},h,t),this.overlay.init(this),this.handler.init(this)}return y(s,[{key:"listen",value:function s(o){if("string"==typeof o)for(var r=document.querySelectorAll(o),a=r.length;a--;)this.listen(r[a]);else"IMG"===o.tagName&&(o.style.cursor=t.zoomIn,e(o,"click",this.handler.click),this.options.preloadImage&&i(n(o)));return this}},{key:"config",value:function t(e){return e?(g(this.options,e),this.overlay.updateStyle(this.options),this):this.options}},{key:"open",value:function t(n){var s=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.onOpen;if(!this.shown&&!this.lock){var r="string"==typeof n?document.querySelector(n):n;if("IMG"===r.tagName){if(this.options.onBeforeOpen(r),this.target.init(r,this),!this.options.preloadImage){var l=this.target.srcOriginal;null!=l&&(this.options.onImageLoading(r),i(l,this.options.onImageLoaded))}this.shown=!0,this.lock=!0,this.target.zoomIn(),this.overlay.insert(),this.overlay.fadeIn(),e(document,"scroll",this.handler.scroll),e(document,"keydown",this.handler.keydown),this.options.closeOnWindowResize&&e(window,"resize",this.handler.resizeWindow);var h=function t(){e(r,a,t,!1),s.lock=!1,s.target.upgradeSource(),s.options.enableGrab&&x(document,s.handler,!0),o(r)};return e(r,a,h),this}}}},{key:"close",value:function i(){var n=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onClose;if(this.shown&&!this.lock){var o=this.target.el;this.options.onBeforeClose(o),this.lock=!0,this.body.style.cursor=t.default,this.overlay.fadeOut(),this.target.zoomOut(),e(document,"scroll",this.handler.scroll,!1),e(document,"keydown",this.handler.keydown,!1),this.options.closeOnWindowResize&&e(window,"resize",this.handler.resizeWindow,!1);var r=function t(){e(o,a,t,!1),n.shown=!1,n.lock=!1,n.target.downgradeSource(),n.options.enableGrab&&x(document,n.handler,!1),n.target.restoreCloseStyle(),n.overlay.remove(),s(o)};return e(o,a,r),this}}},{key:"grab",value:function t(i,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onGrab;if(this.shown&&!this.lock){var r=this.target.el;this.options.onBeforeGrab(r),this.released=!1,this.target.grab(i,n,s);var l=function t(){e(r,a,t,!1),o(r)};return e(r,a,l),this}}},{key:"move",value:function i(n,s){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onMove;if(this.shown&&!this.lock){this.released=!1,this.body.style.cursor=t.move,this.target.move(n,s,o);var l=this.target.el,h=function t(){e(l,a,t,!1),r(l)};return e(l,a,h),this}}},{key:"release",value:function i(){var n=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onRelease;if(this.shown&&!this.lock){var o=this.target.el;this.options.onBeforeRelease(o),this.lock=!0,this.body.style.cursor=t.default,this.target.restoreOpenStyle();var r=function t(){e(o,a,t,!1),n.lock=!1,n.released=!0,s(o)};return e(o,a,r),this}}}]),s}();function x(t,i,n){["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"].forEach(function s(o){e(t,o,i[o],n)})}return $});